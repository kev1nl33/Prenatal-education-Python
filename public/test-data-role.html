<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data-Role æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
        #console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Data-Role åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>1. Data-Role å…ƒç´ æŸ¥æ‰¾æµ‹è¯•</h2>
            <p>æµ‹è¯•æ˜¯å¦èƒ½æ­£ç¡®æ‰¾åˆ°æ‰€æœ‰é…ç½®çš„ data-role å…ƒç´ </p>
            <button onclick="testDataRoleElements()">è¿è¡Œæµ‹è¯•</button>
            <div id="role-test-result" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>2. å…ƒç´ è·å–å‡½æ•°æµ‹è¯•</h2>
            <p>æµ‹è¯• safeGetElementByRole å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
            <button onclick="testElementGetter()">è¿è¡Œæµ‹è¯•</button>
            <div id="getter-test-result" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>3. ROLE-AUDIT ç³»ç»Ÿæµ‹è¯•</h2>
            <p>æµ‹è¯•è§’è‰²å®¡è®¡ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
            <button onclick="testRoleAudit()">è¿è¡Œæµ‹è¯•</button>
            <div id="audit-test-result" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>4. æ§åˆ¶å°è¾“å‡º</h2>
            <p>æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•è¾“å‡ºå’Œè°ƒè¯•ä¿¡æ¯</p>
            <button onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
            <div id="console-output"></div>
        </div>
    </div>
    
    <script>
        // é‡å®šå‘console.logåˆ°é¡µé¢
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        const originalGroup = console.group;
        const originalGroupEnd = console.groupEnd;
        
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        console.group = function(...args) {
            originalGroup.apply(console, args);
            addToConsole('GROUP: ' + args.join(' '), 'group');
        };
        
        console.groupEnd = function() {
            originalGroupEnd.apply(console);
            addToConsole('GROUP END', 'group');
        };
        
        function clearConsole() {
            consoleOutput.textContent = '';
        }
        
        // æµ‹è¯•å‡½æ•°
        function testDataRoleElements() {
            const resultDiv = document.getElementById('role-test-result');
            const expectedRoles = [
                'settings-btn',
                'close-modal', 
                'cancel-config',
                'settings-modal',
                'api-key-input'
            ];
            
            let foundCount = 0;
            let results = [];
            
            expectedRoles.forEach(role => {
                const element = document.querySelector(`[data-role="${role}"]`);
                if (element) {
                    foundCount++;
                    results.push(`âœ… ${role}: æ‰¾åˆ°`);
                    console.log(`æ‰¾åˆ°å…ƒç´ : [data-role="${role}"]`, element);
                } else {
                    results.push(`âŒ ${role}: æœªæ‰¾åˆ°`);
                    console.warn(`æœªæ‰¾åˆ°å…ƒç´ : [data-role="${role}"]`);
                }
            });
            
            const success = foundCount === expectedRoles.length;
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>æµ‹è¯•ç»“æœ:</strong> ${foundCount}/${expectedRoles.length} ä¸ªå…ƒç´ æ‰¾åˆ°<br>
                ${results.join('<br>')}
            `;
            
            console.log(`Data-Role å…ƒç´ æµ‹è¯•å®Œæˆ: ${foundCount}/${expectedRoles.length}`);
        }
        
        function testElementGetter() {
            const resultDiv = document.getElementById('getter-test-result');
            
            // æ¨¡æ‹Ÿ safeGetElementByRole å‡½æ•°
            function safeGetElementByRole(role, required = true) {
                const element = document.querySelector(`[data-role="${role}"]`);
                if (!element && required) {
                    console.warn(`å…ƒç´ æœªæ‰¾åˆ°: [data-role="${role}"]`);
                }
                return element;
            }
            
            const testRoles = ['settings-btn', 'nonexistent-role'];
            let results = [];
            
            testRoles.forEach(role => {
                const element = safeGetElementByRole(role, false);
                if (element) {
                    results.push(`âœ… ${role}: å‡½æ•°æ­£å¸¸è¿”å›å…ƒç´ `);
                    console.log(`safeGetElementByRole('${role}') è¿”å›:`, element);
                } else {
                    results.push(`âš ï¸ ${role}: å‡½æ•°æ­£å¸¸è¿”å› null`);
                    console.log(`safeGetElementByRole('${role}') è¿”å›: null`);
                }
            });
            
            resultDiv.className = 'test-result success';
            resultDiv.innerHTML = `
                <strong>å…ƒç´ è·å–å‡½æ•°æµ‹è¯•ç»“æœ:</strong><br>
                ${results.join('<br>')}
            `;
            
            console.log('å…ƒç´ è·å–å‡½æ•°æµ‹è¯•å®Œæˆ');
        }
        
        function testRoleAudit() {
            const resultDiv = document.getElementById('audit-test-result');
            
            // æ¨¡æ‹Ÿ performRoleAudit å‡½æ•°
            function performRoleAudit() {
                console.log('ğŸ” [ROLE-AUDIT] å¼€å§‹è§’è‰²å®¡è®¡...');
                
                const expectedRoles = [
                    'settings-btn',
                    'close-modal', 
                    'cancel-config',
                    'settings-modal',
                    'api-key-input'
                ];
                
                const foundRoles = [];
                const missingRoles = [];
                
                expectedRoles.forEach(role => {
                    const element = document.querySelector(`[data-role="${role}"]`);
                    if (element) {
                        foundRoles.push({
                            role: role,
                            element: element.tagName.toLowerCase(),
                            id: element.id || 'N/A',
                            className: element.className || 'N/A'
                        });
                    } else {
                        missingRoles.push(role);
                    }
                });
                
                console.group('ğŸ“Š [ROLE-AUDIT] è§’è‰²å®¡è®¡æŠ¥å‘Š');
                
                if (foundRoles.length > 0) {
                    console.log('âœ… æˆåŠŸæ‰¾åˆ°çš„ data-role:');
                    foundRoles.forEach(item => {
                        console.log(`  â€¢ ${item.role} â†’ <${item.element}> (id: ${item.id}, class: ${item.className})`);
                    });
                }
                
                if (missingRoles.length > 0) {
                    console.warn('âŒ æœªæ‰¾åˆ°çš„ data-role:');
                    missingRoles.forEach(role => {
                        console.warn(`  â€¢ ${role}`);
                    });
                }
                
                console.log(`ğŸ“ˆ ç»Ÿè®¡: ${foundRoles.length}/${expectedRoles.length} ä¸ªè§’è‰²å·²æ‰¾åˆ°`);
                console.groupEnd();
                
                return { foundRoles, missingRoles, total: expectedRoles.length };
            }
            
            const auditResult = performRoleAudit();
            
            const success = auditResult.missingRoles.length === 0;
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>ROLE-AUDIT æµ‹è¯•ç»“æœ:</strong><br>
                æ‰¾åˆ°: ${auditResult.foundRoles.length} ä¸ª<br>
                ç¼ºå¤±: ${auditResult.missingRoles.length} ä¸ª<br>
                æ€»è®¡: ${auditResult.total} ä¸ª<br>
                <em>è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º</em>
            `;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ Data-Role æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('è¯·ç‚¹å‡»æµ‹è¯•æŒ‰é’®è¿è¡Œå„é¡¹æµ‹è¯•');
        });
    </script>
</body>
</html>